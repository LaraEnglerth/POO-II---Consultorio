<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhes do Paciente - OdontoPrice</title>
  <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
  <div class="app-container">
    <div id="sidebar"></div>
    
    <main class="main-content">
      <div class="container" style="max-width: 64rem;">
  <a href="./pacientes.html" class="btn btn-ghost mb-4">Voltar</a>
        
        <div id="content">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </main>
  </div>
  
  <script src="./js/api.js"></script>
  <script src="./js/utils.js"></script>
  <script src="./js/components.js"></script>
  <script>
    document.getElementById('sidebar').innerHTML = createSidebar('pacientes');
    
    const id = getQueryParam('id');
    
    async function loadData() {
      try {
        const [paciente, procedimentos] = await Promise.all([
          api.getPaciente(id),
          api.getProcedimentosByPaciente(id)
        ]);
        
        if (!paciente) {
          toast.error('Paciente não encontrado');
          return;
        }
        
        let procedimentosHtml = '';
        if (procedimentos.length === 0) {
          procedimentosHtml = '<p class="text-muted-foreground" style="text-align: center; padding: 2rem;">Nenhum procedimento registrado para este paciente</p>';
        } else {
          procedimentosHtml = `
            <div class="table-wrapper">
              <table class="table">
                <thead>
                  <tr>
                    <th>Procedimento</th>
                    <th>Duração</th>
                    <th>Assistente</th>
                    <th>Valor Final</th>
                  </tr>
                </thead>
                <tbody>
                  ${procedimentos.map(p => `
                    <tr style="cursor: pointer;" onclick="window.location.href='./procedimentos-detalhes.html?id=${p.id}'">
                      <td>${p.nome_procedimento}</td>
                      <td>${p.duracao} min</td>
                      <td>${createBadge(p.assistente === 'S' ? 'Sim' : 'Não', p.assistente === 'S' ? 'primary' : 'secondary')}</td>
                      <td>${formatCurrency(p.valorFinal)}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `;
        }
        
        document.getElementById('content').innerHTML = `
          <div class="page-header">
            <div>
              <h1 class="page-title">${paciente.nome_paciente}</h1>
              <p class="page-subtitle">Detalhes do paciente</p>
            </div>
            <a href="./pacientes-form.html?id=${id}" class="btn btn-primary">
              ${icons.pencil} Editar
            </a>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Informações Gerais</h2>
            </div>
            <div class="card-content">
              <div class="grid grid-cols-3">
                <div>
                  <p style="font-size: 0.875rem; color: var(--muted-foreground);">Nome</p>
                  <p style="font-size: 1.125rem; font-weight: 500; margin-top: 0.25rem;">${paciente.nome_paciente}</p>
                </div>
                <div>
                  <p style="font-size: 0.875rem; color: var(--muted-foreground);">Idade</p>
                  <p style="font-size: 1.125rem; font-weight: 500; margin-top: 0.25rem;">${paciente.idade} anos</p>
                </div>
                <div>
                  <p style="font-size: 0.875rem; color: var(--muted-foreground);">Fidelidade</p>
                  <p style="font-size: 1.125rem; font-weight: 500; margin-top: 0.25rem;">${paciente.fidelidade} visitas</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card" style="margin-top: var(--spacing-lg);">
            <div class="card-header">
              <h2 class="card-title">Procedimentos Realizados</h2>
            </div>
            <div class="card-content">
              ${procedimentosHtml}
            </div>
          </div>
        `;
      } catch (error) {
        toast.error('Erro ao carregar dados');
        console.error(error);
      }
    }
    
    loadData();
  </script>
</body>
</html>
